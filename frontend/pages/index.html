<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto:wght@300;400;500;700&display=swap"
    rel="stylesheet" />
  <title>Home</title>
  <!-- Styles moved to ../css/style.css -->
</head>

<body>
  <header>
    <nav>
      <a href="/pages/index.html" class="home_icon">
        <p class="logo_1">SMPC</p>
        <p class="logo_2">Second-hand Marketplace</p>
      </a>
      <ul class="nav_menu">
        <li><a href="/pages/index.html">Home</a></li>
        <li class="active"><a href="/pages/product_list.html">Product</a></li>
        <li><a href="/pages/customer_products.html">My Products</a></li>
        <li><a href="/pages/about.html">How It Works</a></li>
      </ul>
      <ul class="info_shop">
        <li><img src="/img/icon/search.png" alt="search"></li>
        <li><img src="/img/icon/user.png" alt="user"></li>
        <li><a href="/pages/cart.html" class="cart"><img src="/img/icon/cart.png" alt="cart"></a></li>
        <li class="sellnow"><a href="/pages/sell_product.html"><button>+ SELL NOW</button></a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-inner">
      <h1>Find Your Perfect</h1>
      <h2>Second-Hand Find</h2>
      <p class="lead">Discover quality pre-owned items with personalized AI recommendations. Smart shopping made simple.
      </p>

      <div class="search-wrap">
        <form id="hero-search-form" class="search-box" action="product_list.html" method="get">
          <span class="search-icon">üîç</span>
          <input id="hero-search-input" name="query" type="search"
            placeholder="Search for products, brands, or categories..." aria-label="Search" />
          <button type="submit" aria-label="Search"><span class="btn-icon">ÔøΩ</span> Search</button>
        </form>
      </div>

      <!-- <div class="cta-row">
        <a href="#" class="btn btn-primary"><span class="btn-icon">üõçÔ∏è</span> Start Shopping</a>
        <a href="#" class="btn btn-success"><span class="btn-icon">‚ûï</span> Sell Your Items</a>
      </div> -->

      <!-- Dark translucent panel with badges below the CTAs -->
      <div class="cta-panel">
        <div class="badges">
          <div class="badge-item">‚úÖ Verified Sellers</div>
          <div class="badge-item">ü§ñ AI-Powered Recommendations</div>
          <div class="badge-item">üîí Secure Payments</div>
        </div>
      </div>
    </div>
  </section>

  <section class="popular">
    <h3>Popular Categories</h3>
    <p>Explore thousands of quality second-hand items across different categories</p>
    <div class="categories-grid">
      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/ip13.png');background-size:cover;background-position:center"></div>
        <div class="card-overlay">
          <img src="/img/icon/icons8-document-50.png" alt="icon">
          <div class="card-title">Electronics</div>
          <div class="card-count">2,847 items</div>
        </div>
      </a>

      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/fashion&clothing.png');background-size:cover;background-position:center">
        </div>
        <div class="card-overlay">
          <img src="/img/icon/icons8-home-50.png" alt="icon">
          <div class="card-title">Fashion & Clothing</div>
          <div class="card-count">4,321 items</div>
        </div>
      </a>

      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/books&media.png');background-size:cover;background-position:center">
        </div>
        <div class="card-overlay">
          <img src="/img/icon/icons8-document-50.png" alt="icon">
          <div class="card-title">Books & Media</div>
          <div class="card-count">1,567 items</div>
        </div>
      </a>

      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/home&living.png');background-size:cover;background-position:center">
        </div>
        <div class="card-overlay">
          <img src="/img/icon/icons8-home-50.png" alt="icon">
          <div class="card-title">Home & Living</div>
          <div class="card-count">3,892 items</div>
        </div>
      </a>

      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/sport&outdoors.png');background-size:cover;background-position:center">
        </div>
        <div class="card-overlay">
          <img src="/img/icon/icons8-light-64.png" alt="icon">
          <div class="card-title">Sports & Outdoors</div>
          <div class="card-count">987 items</div>
        </div>
      </a>

      <a class="category-card" href="#">
        <div class="card-media"
          style="background-image:url('/img/body/beauty&heath.png');background-size:cover;background-position:center">
        </div>
        <div class="card-overlay">
          <img src="/img/icon/white heart.png" alt="icon">
          <div class="card-title">Beauty & Health</div>
          <div class="card-count">1,234 items</div>
        </div>
      </a>
    </div>
    <div style="text-align:center;margin-top:20px;"><a class="view-all-link" href="#">View All Categories ‚Üí</a></div>
  </section>

  <section class="featured-products">
    <div class="section-inner">
      <h3>Featured Products</h3>
      <p class="section-sub">Handpicked quality items from trusted sellers with great ratings</p>

      <div class="products-grid">
        <!-- Products will be loaded dynamically from Firebase -->
      </div>
    </div>
  </section>
  <div style="text-align:center;margin-top:20px;margin-bottom:60px;">
    <a class="view-all-link" href="/pages/product_list.html">View All Products ‚Üí</a>
  </div>
  <!-- AI Assistant section (from attachment) -->
  <section class="ai-assistant">
    <div class="ai-inner">
      <div class="ai-col ai-text">
        <h2>AI Assistant - Tr·ª£ l√Ω th√¥ng minh<br>cho m·ªçi giao d·ªãch</h2>
        <p>ƒê∆∞·ª£c h·ªó tr·ª£ b·ªüi c√¥ng ngh·ªá AI ti√™n ti·∫øn, tr·ª£ l√Ω c·ªßa ch√∫ng t√¥i gi√∫p b·∫°n t√¨m ki·∫øm s·∫£n ph·∫©m, so s√°nh gi√° c·∫£ v√†
          ƒë∆∞a ra l·ªùi khuy√™n mua b√°n th√¥ng minh 24/7.</p>

        <ul class="ai-features">
          <li>üîç T√¨m ki·∫øm s·∫£n ph·∫©m th√¥ng minh</li>
          <li>üí° T∆∞ v·∫•n mua h√†ng c√° nh√¢n h√≥a</li>
          <li>‚è∞ H·ªó tr·ª£ 24/7 kh√¥ng gi·ªõi h·∫°n</li>
        </ul>

        <a class="btn btn-primary" href="/pages/ai_chat.html">üîé Try AI Assistant Now</a>
      </div>

      <div class="ai-col ai-media">
        <div class="ai-media-wrap">
          <img src="/img/AI/AI.jpg" alt="AI room" />
          <div class="pill-status">‚óè AI ƒëang ho·∫°t ƒë·ªông</div>
          <div class="badge-247">24/7<br>H·ªó tr·ª£</div>
        </div>
      </div>
    </div>
  </section>

  <div id="footer-placeholder"></div>
  <script>
    // Load footer dynamically
    fetch("footer.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("footer-placeholder").innerHTML = data;
      })
      .catch(err => console.error("Error loading footer:", err));
  </script>

  <!-- Authentication Module -->
  <script type="module">
    import { initAuth, onAuthReady, isAdmin, logout, protectActionButtons } from '../js/auth_manager.js';

    // Initialize Firebase authentication
    initAuth();

    // Handle auth state changes
    onAuthReady((user, claims) => {
      // Protect "Buy Now" buttons after auth state is ready
      protectActionButtons('.btn-add', 'You need to log in to buy this product');

      const userIcon = document.querySelector('.info_shop li:nth-child(2)');

      if (user) {
        // User is logged in
        console.log('[Index] User logged in:', user.email);

        // Check if admin - redirect to dashboard
        if (claims?.admin === true) {
          console.log('[Index] Admin detected, showing dashboard access');

          // Add "Go to Dashboard" button to nav if admin
          if (userIcon && !document.getElementById('adminDashboardBtn')) {
            const dashboardBtn = document.createElement('li');
            dashboardBtn.id = 'adminDashboardBtn';
            dashboardBtn.innerHTML = `
              <a href="/admin/dashboard.html" style="
                background: #4F46E5;
                color: white;
                padding: 8px 16px;
                border-radius: 6px;
                text-decoration: none;
                font-weight: 500;
                display: inline-block;
              ">
                üìä Dashboard
              </a>
            `;
            userIcon.parentNode.insertBefore(dashboardBtn, userIcon);
          }
        }

        // Update user icon to show dropdown with logout
        if (userIcon) {
          const img = userIcon.querySelector('img');
          if (img) {
            // Add click handler for logout
            img.style.cursor = 'pointer';
            img.title = `Logged in as ${user.email}\nClick to logout`;

            img.addEventListener('click', async () => {
              if (confirm('Are you sure you want to logout?')) {
                const { logout } = await import('../js/auth_manager.js');
                await logout('/pages/index.html');
              }
            });
          }
        }

      } else {
        // User is logged out
        console.log('[Index] User not logged in');

        // Update user icon to link to login page
        if (userIcon) {
          const img = userIcon.querySelector('img');
          if (img) {
            img.style.cursor = 'pointer';
            img.title = 'Click to login';

            img.addEventListener('click', () => {
              window.location.href = '/login';
            });
          }
        }
      }
    });
  </script>

  <!-- Quick Access Buttons for Orders (non-intrusive addition) -->
  <script type="module">
    import { onAuthReady } from '../js/auth_manager.js';

    onAuthReady((user) => {
      const infoShop = document.querySelector('.info_shop');
      if (!infoShop) return;

      const existingBuyer = document.getElementById('buyerOrdersBtn');
      const existingSeller = document.getElementById('sellerOrdersBtn');

      const removeIfExists = (el) => { if (el && el.parentNode) el.parentNode.removeChild(el); };

      if (user) {
        // Insert before the user icon if possible, else append to the end
        const userIcon = infoShop.querySelector('li:nth-child(2)');

        if (!existingBuyer) {
          const buyerLi = document.createElement('li');
          buyerLi.id = 'buyerOrdersBtn';
          buyerLi.innerHTML = `
            <a href="/pages/buyer_orders.html" style="
              background: #0EA5E9;
              color: white;
              padding: 8px 12px;
              border-radius: 6px;
              text-decoration: none;
              font-weight: 500;
              display: inline-block;
            ">üõí My Orders</a>
          `;
          if (userIcon && userIcon.parentNode) {
            userIcon.parentNode.insertBefore(buyerLi, userIcon);
          } else {
            infoShop.appendChild(buyerLi);
          }
        }

        if (!existingSeller) {
          const sellerLi = document.createElement('li');
          sellerLi.id = 'sellerOrdersBtn';
          sellerLi.innerHTML = `
            <a href="/pages/seller_orders.html" style="
              background: #16A34A;
              color: white;
              padding: 8px 12px;
              border-radius: 6px;
              text-decoration: none;
              font-weight: 500;
              display: inline-block;
              margin-right: 8px;
            ">üì¶ My Sales</a>
          `;
          const insertBefore = document.getElementById('buyerOrdersBtn') || userIcon;
          if (insertBefore && insertBefore.parentNode) {
            insertBefore.parentNode.insertBefore(sellerLi, insertBefore);
          } else {
            infoShop.appendChild(sellerLi);
          }
        }
      } else {
        // Remove buttons when logged out
        removeIfExists(existingBuyer);
        removeIfExists(existingSeller);
      }
    });
  </script>
</body>
<script src="../js/index_search.js"></script>
<script src="../js/index_categories.js"></script>
<script src="../js/index_products.js"></script>
<script src="../js/header_sticky.js"></script>

</html>